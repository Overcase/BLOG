<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>微信H5长按保存图片 | Linhf</title>
    <meta name="description" content="永远不要忘记你的欲望和恐惧 ">
    <link rel="icon" href="/logo.png">
    <meta name="weChat" content="This article show VueX core composition"><meta name="weChat" content="微信H5长按保存图片demo">
    <link rel="preload" href="/assets/css/styles.7fa88ce5.css" as="style"><link rel="preload" href="/assets/js/app.7fa88ce5.js" as="script"><link rel="preload" href="/assets/css/styles.7fa88ce5.css" as="style"><link rel="preload" href="/assets/js/44.50360408.js" as="script"><link rel="prefetch" href="/assets/css/1.styles.eeb43671.css"><link rel="prefetch" href="/assets/css/2.styles.50882dc4.css"><link rel="prefetch" href="/assets/js/1.eeb43671.js"><link rel="prefetch" href="/assets/js/10.decc3d39.js"><link rel="prefetch" href="/assets/js/11.0a3b1f05.js"><link rel="prefetch" href="/assets/js/12.b6be7e7b.js"><link rel="prefetch" href="/assets/js/13.44149539.js"><link rel="prefetch" href="/assets/js/14.99a5558f.js"><link rel="prefetch" href="/assets/js/15.0ac7724e.js"><link rel="prefetch" href="/assets/js/16.1691e973.js"><link rel="prefetch" href="/assets/js/17.ae866f11.js"><link rel="prefetch" href="/assets/js/18.8cafb262.js"><link rel="prefetch" href="/assets/js/19.933374fc.js"><link rel="prefetch" href="/assets/js/2.50882dc4.js"><link rel="prefetch" href="/assets/js/20.f4444e8f.js"><link rel="prefetch" href="/assets/js/21.503eae05.js"><link rel="prefetch" href="/assets/js/22.9be6e08d.js"><link rel="prefetch" href="/assets/js/23.29ea216f.js"><link rel="prefetch" href="/assets/js/24.c50c9b98.js"><link rel="prefetch" href="/assets/js/25.7dc290ba.js"><link rel="prefetch" href="/assets/js/26.33e4236f.js"><link rel="prefetch" href="/assets/js/27.150a023a.js"><link rel="prefetch" href="/assets/js/28.facbdbed.js"><link rel="prefetch" href="/assets/js/29.2c9fc6a3.js"><link rel="prefetch" href="/assets/js/3.852f1526.js"><link rel="prefetch" href="/assets/js/30.98eabcc3.js"><link rel="prefetch" href="/assets/js/31.0fb90340.js"><link rel="prefetch" href="/assets/js/32.c3cc4dd3.js"><link rel="prefetch" href="/assets/js/33.6fdaef1e.js"><link rel="prefetch" href="/assets/js/34.8cd6cd5e.js"><link rel="prefetch" href="/assets/js/35.1b190fa1.js"><link rel="prefetch" href="/assets/js/36.59a11581.js"><link rel="prefetch" href="/assets/js/37.3adea853.js"><link rel="prefetch" href="/assets/js/38.b8d84bbe.js"><link rel="prefetch" href="/assets/js/39.d9d3217b.js"><link rel="prefetch" href="/assets/js/4.c5af5a6d.js"><link rel="prefetch" href="/assets/js/40.3d776593.js"><link rel="prefetch" href="/assets/js/41.295d7d85.js"><link rel="prefetch" href="/assets/js/42.22e8987a.js"><link rel="prefetch" href="/assets/js/43.2fdc4cc1.js"><link rel="prefetch" href="/assets/js/5.bdce62ca.js"><link rel="prefetch" href="/assets/js/6.3a83f800.js"><link rel="prefetch" href="/assets/js/7.bfa3b351.js"><link rel="prefetch" href="/assets/js/8.a46fdee8.js"><link rel="prefetch" href="/assets/js/9.57d36df0.js">
    <link rel="stylesheet" href="/assets/css/1.styles.eeb43671.css"><link rel="stylesheet" href="/assets/css/2.styles.50882dc4.css"><link rel="stylesheet" href="/assets/css/styles.7fa88ce5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="wrap"><div class="theme-container container no-sidebar"><header class="navbar"><div class="nav-header"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" class="logo"> <span class="site-name can-hide">
        Linhf
      </span></a> <nav class="nav-links can-hide"><div class="nav-item"><a href="/live/" class="nav-link">Home</a></div><div class="nav-item"><a href="/tags/" class="nav-link">TAGS</a></div><div class="nav-item"><a href="https://github.com/Overcase" target="_blank" rel="noopener noreferrer" class="nav-link">GitHub</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div> <!----></nav> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/live/" class="nav-link">Home</a></div><div class="nav-item"><a href="/tags/" class="nav-link">TAGS</a></div><div class="nav-item"><a href="https://github.com/Overcase" target="_blank" rel="noopener noreferrer" class="nav-link">GitHub</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div> <!----></nav> <!----></div> <div class="page-container"><div><div class="page card"><div class="content-header"><h1 class="page-title" style="color:#ac3e40;">
        微信H5长按保存图片
      </h1> <span class="page-timestamp">2017-11-25</span></div> <div class="content"><p>本篇给出了长按保存图片的demo
</p> <h2 id="长按保存图片实例"><a href="#长按保存图片实例" aria-hidden="true" class="header-anchor">#</a> 长按保存图片实例</h2> <ul><li>采用canvas画布画出页面中的元素</li> <li>获取页面中的图片加载到canvas中（把原本页面中的图片隐藏[display:none]）隐藏原本的元素也是可以获取到在画布上绘画的</li> <li>将canvas的高度设置为手机高度（<code>document.body.clientHeight</code>） * 设备像素比(<code>window.devicePixelRatio</code>)</li> <li>在将canvas的style高度设置为手机高度（<code>document.body.clientHeight</code>）</li> <li>canvas中绘画的背景也要设置为canvas的高度和宽度（不是style的）</li> <li>canvas中添加图片也可以用<code>new Image()</code> 然后用新创建的图片</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>   <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>封装了写字（可忽略）<span class="token operator">--</span><span class="token operator">&gt;</span>
   <span class="token function">fillText</span> <span class="token punctuation">(</span>cxt<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     cxt<span class="token punctuation">.</span>textBaseline <span class="token operator">=</span> <span class="token string">'top'</span>
     cxt<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">'16px Arial'</span>
     cxt<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#000'</span>
     cxt<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>desc<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>封装了图片加载和加载结束事件（可忽略）<span class="token operator">--</span><span class="token operator">&gt;</span>
   <span class="token function">drawImg</span> <span class="token punctuation">(</span>img<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>

       img<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">/* eslint-disable */</span>
         <span class="token function">reject</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>ios检测<span class="token operator">--</span><span class="token operator">&gt;</span>
   <span class="token function">isIOS</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">var</span> u <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span>
     <span class="token keyword">var</span> isiOS <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>u<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/\(i[^;]+;( U;)? CPU.+Mac OS X/</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ios终端</span>
     <span class="token keyword">return</span> isiOS
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token keyword">async</span>  <span class="token function">readCavasImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

     <span class="token keyword">const</span> <span class="token punctuation">{</span>clientHeight<span class="token punctuation">,</span> clientWidth<span class="token punctuation">}</span> <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">;</span> 
       
     <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>图片加载方式之新建<span class="token operator">--</span><span class="token operator">&gt;</span>
     <span class="token keyword">let</span> img1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     canvas<span class="token punctuation">.</span>width <span class="token operator">=</span>  clientWidth <span class="token operator">*</span> window<span class="token punctuation">.</span>devicePixelRatio
     canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> clientHeight <span class="token operator">*</span> window<span class="token punctuation">.</span>devicePixelRatio
     canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> clientWidth <span class="token operator">+</span> <span class="token string">'px'</span>
     canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> clientHeight <span class="token operator">+</span> <span class="token string">'px'</span>

     <span class="token keyword">let</span> cxt <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     img1<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token string">`static/answers/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>imgUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
     <span class="token comment">// cross &amp;&amp; img1.setAttribute(&quot;crossOrigin&quot;,'Anonymous')</span>

     <span class="token keyword">const</span> f1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drawImg</span><span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token comment">// 画背景</span>
       cxt<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img1<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>        
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
     <span class="token comment">// // 画月亮</span>
     <span class="token keyword">let</span> moonDraw <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>moonDraw
     <span class="token keyword">let</span> computedWidth <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width
     cxt<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>moonDraw<span class="token punctuation">,</span> computedWidth <span class="token operator">-</span> <span class="token punctuation">(</span>computedWidth <span class="token operator">/</span> <span class="token number">3.5</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> computedWidth <span class="token operator">/</span> <span class="token number">3.5</span><span class="token punctuation">,</span> computedWidth <span class="token operator">/</span> <span class="token number">3.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     
     <span class="token comment">// 画字</span>
     cxt<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">&quot;bold 45px Arial&quot;</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isIOS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span>clientHeight <span class="token operator">&lt;</span> <span class="token number">650</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>   
         cxt<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">.</span>userName<span class="token punctuation">,</span> computedWidth <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">73</span><span class="token punctuation">,</span> clientHeight <span class="token operator">/</span> <span class="token number">2.5</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         cxt<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">&quot;bold 60px Arial&quot;</span><span class="token punctuation">;</span>
         cxt<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">.</span>userName<span class="token punctuation">,</span> computedWidth <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">,</span> clientHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
       
     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
       cxt<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$root<span class="token punctuation">.</span>userName<span class="token punctuation">,</span> computedWidth <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">60</span><span class="token punctuation">,</span> clientHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span>
       
     cxt<span class="token punctuation">.</span>textBaseline <span class="token operator">=</span> <span class="token string">'middle'</span><span class="token punctuation">;</span> <span class="token comment">//设置文本的垂直对齐方式</span>
     cxt<span class="token punctuation">.</span>textAlign <span class="token operator">=</span> <span class="token string">'center'</span><span class="token punctuation">;</span><span class="token comment">//设置文本的水平对齐方式</span>
     

     <span class="token keyword">let</span> img3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     img3<span class="token punctuation">.</span>width <span class="token operator">=</span> clientWidth<span class="token punctuation">;</span>
     img3<span class="token punctuation">.</span>height <span class="token operator">=</span> clientHeight<span class="token punctuation">;</span>      
     <span class="token comment">// 获取url</span>
     <span class="token keyword">let</span> img3Url <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     img3<span class="token punctuation">.</span>src <span class="token operator">=</span> img3Url<span class="token punctuation">;</span>

     <span class="token keyword">const</span> f2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drawImg</span><span class="token punctuation">(</span>img3<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>printMe<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img3<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
</code></pre></div></div> <!----> <div class="content page-nav"><p class="inner"><span class="prev">
          ← <a href="/blog/VueX.html" class="prev">
            VueX基础案例
          </a></span> <span class="next"><a href="/blog/InstallMG.html">
            Install MongoDB Community Edition with Homebrew
          </a> →
        </span></p></div></div> <!----></div> <!----></div> <div class="tool-group"><!----></div></div> <!----></div> <div class="background-mask" style="background:#f6f6f6;"></div></div></div>
    <script src="/assets/js/44.50360408.js" defer></script><script src="/assets/js/app.7fa88ce5.js" defer></script>
  </body>
</html>
